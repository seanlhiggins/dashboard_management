{"version":3,"sources":["../../../../src/Form/Inputs/InputFilters/InputFilters.tsx"],"names":["useTranslation","omit","styled","React","useMemo","useState","useRef","Close","FilterList","Select","InputText","Icon","IconButton","Chip","Text","Popover","PopoverContent","InputFiltersChip","inputFilterEditor","InputFiltersLayout","className","filters","hideFilterIcon","onChange","t","undefined","fieldEditing","setFieldEditing","assignedFilters","filter","value","field","sort","a","b","unassignedFilters","map","assigned","includes","filterTerm","setFilterTerm","options","reduce","acc","option","label","optionMatchesFilter","Object","values","some","toLocaleLowerCase","indexOf","inputRef","isClearable","length","clearFilters","focusInput","current","focus","handleFilterLookupChange","find","i","editor","editFilter","handleDelete","currentFilter","setFieldEditingValue","filterIndex","findIndex","f","newFilters","updateFilter","closeEditor","filterToken","filterOptions","ChipWrapper","div","theme","space","xxsmall","InputFilters","colors","ui2","radii","medium","xxxsmall","xsmall"],"mappings":"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","sourcesContent":["/*\n\n MIT License\n\n Copyright (c) 2021 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\n\nimport { useTranslation } from 'react-i18next'\nimport omit from 'lodash/omit'\nimport styled from 'styled-components'\nimport React, { FC, useMemo, useState, useRef } from 'react'\nimport { Close } from '@styled-icons/material/Close'\nimport { FilterList } from '@styled-icons/material/FilterList'\nimport { Select, SelectOptionObject } from '../Select'\nimport { InputText } from '../InputText'\nimport { Icon } from '../../../Icon'\nimport { IconButton } from '../../../Button'\nimport { Chip } from '../../../Chip'\nimport { Text } from '../../../Text'\nimport { Popover, PopoverContent } from '../../../Popover'\nimport { InputFiltersChip } from './InputFiltersChip'\nimport { inputFilterEditor } from './inputFilterEditor'\nimport { InputFiltersProps } from './types'\n\nconst InputFiltersLayout: FC<InputFiltersProps> = ({\n  className,\n  filters,\n  hideFilterIcon = false,\n  onChange,\n}) => {\n  const { t } = useTranslation('InputFilters')\n  const [fieldEditing, setFieldEditing] = useState<undefined | string>(\n    undefined\n  )\n  const assignedFilters = filters\n    .filter((filter) => filter.value || filter.field === fieldEditing)\n    .sort((a, b) =>\n      a.value === undefined ? 1 : b.value === undefined ? -1 : 0\n    )\n\n  const unassignedFilters = filters.filter(\n    (filter) =>\n      !assignedFilters.map((assigned) => assigned.field).includes(filter.field)\n  )\n\n  const [filterTerm, setFilterTerm] = useState('')\n\n  const options = useMemo(\n    () =>\n      unassignedFilters.reduce((acc: SelectOptionObject[], filter) => {\n        const option = {\n          label: filter.label || filter.field,\n          value: filter.field,\n        }\n        const optionMatchesFilter = Object.values(option).some(\n          (value: string) =>\n            value.toLocaleLowerCase().indexOf(filterTerm.toLocaleLowerCase()) >\n            -1\n        )\n        if (optionMatchesFilter) {\n          acc = [...acc, option]\n        }\n        return acc\n      }, []),\n    [filterTerm, unassignedFilters]\n  )\n\n  const inputRef = useRef<null | HTMLInputElement>(null)\n  const isClearable = assignedFilters.length > 0\n\n  const clearFilters = () => {\n    onChange(filters.map((filter) => omit(filter, 'value')))\n  }\n\n  const focusInput = () => inputRef.current && inputRef.current.focus()\n\n  const handleFilterLookupChange = (field: string) => {\n    const filter = filters.find((option) => option.field === field)\n    if (filter) {\n      setFieldEditing(filter.field)\n    }\n  }\n\n  return (\n    <div className={className} onClick={focusInput}>\n      {!hideFilterIcon && (\n        <Icon\n          color=\"ui4\"\n          mr=\"xsmall\"\n          mt=\"xxsmall\"\n          icon={<FilterList />}\n          size={20}\n        />\n      )}\n      <ChipWrapper>\n        {assignedFilters.map((filter, i) => {\n          const { editor, field, value } = filter\n\n          const editFilter = () => setFieldEditing(field)\n\n          const handleDelete = () =>\n            onChange(\n              filters.map((currentFilter) =>\n                currentFilter.field !== field\n                  ? currentFilter\n                  : omit(currentFilter, 'value')\n              )\n            )\n\n          const setFieldEditingValue = (value?: string) => {\n            const filterIndex = assignedFilters.findIndex(\n              (f) => f.field === fieldEditing\n            )\n\n            const newFilters = [...assignedFilters, ...unassignedFilters]\n            const updateFilter = { ...newFilters[filterIndex], value }\n            newFilters[filterIndex] = updateFilter\n\n            onChange(newFilters)\n          }\n\n          const closeEditor = () => setFieldEditing(undefined)\n\n          const filterToken = value ? (\n            <InputFiltersChip\n              filter={filter}\n              key={i}\n              onClick={editFilter}\n              onDelete={handleDelete}\n            />\n          ) : (\n            <Text fontSize=\"small\" lineHeight=\"xlarge\">\n              {filter?.label || filter.field}:\n            </Text>\n          )\n          return filter.field === fieldEditing ? (\n            <Popover\n              content={\n                <PopoverContent>\n                  {editor\n                    ? editor({\n                        closeEditor,\n                        filterOptions: filter,\n                        onChange: setFieldEditingValue,\n                        value,\n                      })\n                    : inputFilterEditor({\n                        closeEditor,\n                        filterOptions: filter,\n                        onChange: setFieldEditingValue,\n                        value,\n                      })}\n                </PopoverContent>\n              }\n              isOpen={fieldEditing !== undefined}\n              key={i}\n              placement={t('bottom-start')}\n              setOpen={closeEditor}\n            >\n              {filterToken}\n            </Popover>\n          ) : (\n            filterToken\n          )\n        })}\n        {!fieldEditing && (\n          <Select\n            autoResize\n            openOnFocus\n            indicator={false}\n            onFilter={setFilterTerm}\n            isFilterable\n            onChange={handleFilterLookupChange}\n            options={options}\n            placeholder={t('Filter List')}\n            ref={inputRef}\n          />\n        )}\n      </ChipWrapper>\n      {isClearable && (\n        <IconButton\n          icon={<Close />}\n          label={t('Clear Filters')}\n          ml=\"auto\"\n          mt=\"xxsmall\"\n          mr=\"xsmall\"\n          onClick={clearFilters}\n          size=\"xsmall\"\n        />\n      )}\n    </div>\n  )\n}\n\nconst ChipWrapper = styled.div`\n  display: inline-flex;\n  flex: 1;\n  flex-wrap: wrap;\n\n  @supports (gap: 4px) {\n    gap: ${({ theme }) => theme.space.xxsmall};\n    ${Chip} {\n      margin: 0;\n    }\n  }\n`\n\nexport const InputFilters = styled(InputFiltersLayout)`\n  align-items: start;\n  border: solid 1px ${({ theme }) => theme.colors.ui2};\n  border-radius: ${({ theme: { radii } }) => radii.medium};\n  display: flex;\n  flex-wrap: wrap;\n  padding: ${({ theme: { space } }) => space.xxxsmall} 0;\n  padding-left: ${({ theme: { space } }) => space.xsmall};\n\n  width: 100%;\n\n  ${Select} {\n    margin-left: ${({ theme: { space } }) => space.xxsmall};\n  }\n\n  ${Select} ${Icon} {\n    display: none;\n  }\n\n  ${InputText} {\n    border: none;\n    height: 30px;\n    padding: 0;\n\n    &:focus-within {\n      box-shadow: none;\n    }\n\n    input {\n      padding: 0;\n    }\n  }\n`\n"],"file":"InputFilters.js"}